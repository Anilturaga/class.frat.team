const firebaseConfig={apiKey:"AIzaSyA_9vMyUjwZ_jW4Ns5OHtCfani6JEZ96gk",authDomain:"fir-rtc-926a7.firebaseapp.com",databaseURL:"https://fir-rtc-926a7.firebaseio.com",projectId:"fir-rtc-926a7",storageBucket:"fir-rtc-926a7.appspot.com",messagingSenderId:"144707184991",appId:"1:144707184991:web:09998d930d448166776eea",measurementId:"G-JXS9N4TYGH"};firebase.initializeApp(firebaseConfig);const urlParams=new URLSearchParams(window.location.search);var USER_CRED,quizFormBit,attIntervalListener;null===urlParams.get("c")||null===urlParams.get("r")||null===urlParams.get("w")||null===urlParams.get("j")||null===urlParams.get("u")||null===urlParams.get("roll")?void 0!==localStorage.className&&void 0!==localStorage.roomID&&void 0!==localStorage.whiteboard&&void 0!==localStorage.jitsi&&void 0!==localStorage.username&&void 0!==localStorage.roll||(console.log("/////////////*************************"),console.log(localStorage.c,urlParams.get("c"),urlParams.get("r"),urlParams.get("w"),urlParams.get("j"),urlParams.get("u"),urlParams.get("roll"))):(localStorage.setItem("className",urlParams.get("c")),localStorage.setItem("roomID",urlParams.get("r")),localStorage.setItem("whiteboard",urlParams.get("w")),localStorage.setItem("jitsi",urlParams.get("j")),console.log("hey",localStorage.jitsi),localStorage.setItem("username",urlParams.get("u")),localStorage.setItem("roll",urlParams.get("roll")),localStorage.att=0,console.log(typeof localStorage.roomID),console.log("////////-----------------------")),console.log(localStorage.className);var reloadBit="none",db=firebase.firestore();const player=document.getElementById("player"),canvas=document.getElementById("canvas"),context=canvas.getContext("2d"),constraints={video:!0};firebase.auth().onAuthStateChanged(function(e){e?(USER_CRED=e,console.log(localStorage.username,"{{{{{{{{{{{{{{{{{"),api.executeCommand("displayName",localStorage.getItem("username"))):firebase.auth().signInAnonymously().catch(function(e){console.log("error");e.code,e.message})});var clientHeight=document.documentElement.scrollHeight-100;document.getElementById("view-source").style.display="none",db.collection("rooms").doc(localStorage.getItem("roomID")).onSnapshot(function(e){console.log("|||||||||||||||||||||||||||||||||||||||||||||||||",e.data());try{var t=e.data().quizForm;console.log("try",t),void 0===t?document.getElementById("view-source").style.display="none":(document.getElementById("view-source").href=t,document.getElementById("view-source").style.display="block")}catch(e){console.log("not yet form",e)}try{var o=e.data().startClass;if(!1===o){if(console.log("class not started"),!0===reloadBit){var a=Math.floor(1e4*Math.random()).toString();console.log("Sending in attendance",localStorage.att,localStorage.getItem("roomID")),db.collection("rooms").doc(localStorage.getItem("roomID")).collection("meta").doc("attendance").set({[a]:{username:localStorage.getItem("username"),roll:localStorage.getItem("roll"),att:localStorage.att}},{merge:!0}).then(function(){console.log("db success"),localStorage.att=0}).catch(function(e){console.error("Error writing document: ",e),res.send({status:2})}),window.clearInterval(attIntervalListener)}}else!0===o&&(reloadBit=!0,attIntervalListener=setInterval(smartAttendance,3e3))}catch(e){console.log("not yet")}}),setTimeout(function(){const e={roomName:localStorage.getItem("jitsi"),height:clientHeight,parentNode:document.querySelector("#meet"),configOverwrite:{startWithAudioMuted:!0,startWithVideoMuted:!0,disableDeepLinking:!0},interfaceConfigOverwrite:{TOOLBAR_BUTTONS:["microphone","fullscreen","fodeviceselection","profile","chat","settings","raisehand","videoquality"],DEFAULT_BACKGROUND:"white",MOBILE_APP_PROMO:!1,HIDE_INVITE_MORE_HEADER:!0,SHOW_CHROME_EXTENSION_BANNER:!1,DEFAULT_REMOTE_DISPLAY_NAME:"Student",DISPLAY_WELCOME_PAGE_CONTENT:!1,ENABLE_DIAL_OUT:!1}};console.log(localStorage.jitsi,"bye");new JitsiMeetExternalAPI("meet.jit.si",e);document.getElementById("jitsiConferenceFrame0").allow="microphone"},3e3);var d1=document.getElementById("whiteboard");function conductQuizFunction(){var e=document.getElementById("professsion").value;db.collection("rooms").doc(localStorage.getItem("roomID")).set({quizForm:e},{merge:!0})}function hideQuizButton(){document.getElementById("view-source").style.display="none"}function smartAttendance(){console.log("7777777777777777777777777777777777777777777777777777777"),context.drawImage(player,0,0,canvas.width,canvas.height),main()}async function main(){const e=await blazeface.load(),t=await e.estimateFaces(document.getElementById("canvas"),!1);console.log(localStorage.att,"predictions"),t.length>0&&("visible"==document.visibilityState&&(localStorage.att=Number(localStorage.att)+1),console.log(localStorage.att,"predictions"))}d1.insertAdjacentHTML("beforeend",'<iframe id="wbo" width="100%" height="'+clientHeight+'" src="https://wbo.ophir.dev/boards/'+localStorage.getItem("whiteboard")+'" title="whiteboard">'),document.getElementById("wbo").seamless=!0,setTimeout(function(){document.getElementById("overlay").style.width="35%",document.getElementById("overlay").style.height="100%",console.log("Overlay enabled",document.getElementById("overlay").style.width,document.getElementById("whiteboard").style.width)},7e3),navigator.mediaDevices.getUserMedia(constraints).then(e=>{player.srcObject=e}).catch(e=>{console.log("Can't access camera bro")});